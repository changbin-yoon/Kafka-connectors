---
# Rook-Ceph RGW Ingress 설정
# 물리적으로 분리된 클러스터에서 Ceph RGW에 접근하기 위한 Ingress
# 
# 사용 방법:
# 1. Ceph 클러스터에 Ingress Controller가 설치되어 있어야 합니다 (nginx, traefik 등)
# 2. 호스트 이름과 인증서 정보를 수정합니다
# 3. Ceph 클러스터에서 이 파일을 적용:
#    kubectl apply -f rook-ceph-rgw-ingress.yaml -n rook-ceph
#
# 4. 외부 클러스터에서 접근:
#    http://ceph-rgw.example.com 형식으로 접근

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: rook-ceph-rgw-ingress
  namespace: rook-ceph
  annotations:
    # Nginx Ingress Controller 사용 시
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/proxy-body-size: "0"  # 파일 업로드 크기 제한 제거
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    
    # Traefik 사용 시 (주석 해제하여 사용)
    # traefik.ingress.kubernetes.io/router.entrypoints: web
    # traefik.ingress.kubernetes.io/router.middlewares: default-headers
    
    # 기본 인증 제거 (S3 요청에는 인증 헤더가 필요)
    nginx.ingress.kubernetes.io/auth-type: "none"
spec:
  ingressClassName: nginx  # 실제 사용하는 Ingress Controller 클래스 이름으로 변경
  # rules:
  # - host: ceph-rgw.example.com  # 실제 도메인 이름으로 변경
  #   http:
  #     paths:
  #     - path: /
  #       pathType: Prefix
  #       backend:
  #         service:
  #           name: rook-ceph-rgw-my-store  # 실제 RGW 서비스 이름으로 변경
  #           port:
  #             number: 80
  # # TLS 설정 (선택사항)
  # tls:
  # - hosts:
  #   - ceph-rgw.example.com
  #   secretName: ceph-rgw-tls  # TLS 인증서 Secret 이름

---
# 예시: 실제 RGW 서비스 이름 확인을 위한 Helper
# kubectl get svc -n rook-ceph | grep rook-ceph-rgw
# 위 명령어로 확인한 서비스 이름을 위 Ingress의 service.name에 입력하세요

